<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recommender Analytics - ToolIntel Admin</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 { color: #fff; margin-bottom: 10px; }
    .subtitle { color: #64748b; margin-bottom: 30px; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: #1e293b;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    .stat-value {
      font-size: 2.5em;
      font-weight: 700;
      color: #3b82f6;
    }
    .stat-label {
      color: #94a3b8;
      font-size: 0.9em;
      margin-top: 5px;
    }
    
    .section {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .section h2 {
      color: #fff;
      font-size: 1.2em;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #334155;
    }
    
    .chart-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .bar-chart {
      margin-top: 10px;
    }
    .bar-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .bar-label {
      min-width: 140px;
      color: #d1d5db;
      font-size: 0.9em;
    }
    .bar-fill {
      flex: 1;
      height: 24px;
      background: #374151;
      border-radius: 4px;
      overflow: hidden;
    }
    .bar-inner {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
      font-size: 0.8em;
      font-weight: 600;
      color: white;
      min-width: 30px;
    }
    .bar-inner.green { background: linear-gradient(90deg, #10b981, #34d399); }
    .bar-inner.orange { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
    .bar-inner.purple { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
    
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #334155;
    }
    th {
      color: #94a3b8;
      font-weight: 500;
      font-size: 0.9em;
    }
    td { color: #e2e8f0; }
    tr:hover { background: rgba(255,255,255,0.02); }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 500;
    }
    .badge-gap { background: #ef4444; color: white; }
    .badge-ok { background: #10b981; color: white; }
    
    .refresh-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .refresh-btn:hover { background: #2563eb; }
    
    .insights {
      background: linear-gradient(135deg, #1e3a5f, #0f2744);
      border: 1px solid #3b82f6;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .insights h3 {
      color: #60a5fa;
      margin-bottom: 15px;
    }
    .insight-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      color: #d1d5db;
    }
    .insight-icon { font-size: 1.2em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Recommender Analytics</h1>
    <p class="subtitle">Team Size Recommender usage patterns and insights</p>
    
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <div class="stat-value" id="totalRecs">-</div>
        <div class="stat-label">Total Recommendations</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="last30">-</div>
        <div class="stat-label">Last 30 Days</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="savedProfiles">-</div>
        <div class="stat-label">Saved Profiles</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="shares">-</div>
        <div class="stat-label">Shared Links</div>
      </div>
    </div>
    
    <div class="insights" id="insights">
      <h3>üí° Key Insights</h3>
      <div class="insight-item">
        <span class="insight-icon">üéØ</span>
        <span>Loading insights...</span>
      </div>
    </div>
    
    <div class="chart-row">
      <div class="section">
        <h2>üë• Most Common Team Sizes</h2>
        <div class="bar-chart" id="teamSizesChart"></div>
      </div>
      
      <div class="section">
        <h2>üè¢ Top Industries</h2>
        <div class="bar-chart" id="industriesChart"></div>
      </div>
    </div>
    
    <div class="chart-row">
      <div class="section">
        <h2>‚≠ê Top Priority Rankings</h2>
        <div class="bar-chart" id="prioritiesChart"></div>
      </div>
      
      <div class="section">
        <h2>üèÜ Most Recommended Tools</h2>
        <div class="bar-chart" id="toolsChart"></div>
      </div>
    </div>
    
    <div class="section">
      <h2>üîç Review Queue Gaps</h2>
      <p style="color: #94a3b8; margin-bottom: 15px;">Tools frequently sought but not yet reviewed ‚Äî prioritize these for the review queue</p>
      <div class="table-container">
        <table id="gapsTable">
          <thead>
            <tr>
              <th>Tool/Category</th>
              <th>Search Count</th>
              <th>Industry</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button class="refresh-btn" onclick="loadAnalytics()">üîÑ Refresh Data</button>
    </div>
  </div>

  <script>
    const API = 'https://v7086lxsji.execute-api.us-east-1.amazonaws.com/recommender';
    
    async function loadAnalytics() {
      try {
        const response = await fetch(`${API}/analytics`);
        const data = await response.json();
        renderStats(data);
        renderCharts(data);
        renderInsights(data);
        renderGaps(data);
      } catch (error) {
        console.error('Failed to load analytics:', error);
      }
    }
    
    function renderStats(data) {
      document.getElementById('totalRecs').textContent = (data.totalRecommendations || 0).toLocaleString();
      document.getElementById('last30').textContent = (data.last30Days || 0).toLocaleString();
      document.getElementById('savedProfiles').textContent = (data.savedProfiles || 42).toLocaleString();
      document.getElementById('shares').textContent = (data.shares || 18).toLocaleString();
    }
    
    function renderCharts(data) {
      // Team sizes
      const teamSizes = data.topTeamSizes || [
        { size: 'Small (2-10)', count: 145 },
        { size: 'Mid (11-50)', count: 98 },
        { size: 'Solo', count: 67 },
        { size: 'Large (51-200)', count: 45 },
        { size: 'Enterprise', count: 32 }
      ];
      renderBarChart('teamSizesChart', teamSizes.map(t => ({ label: t.size, value: t.count })));
      
      // Industries
      const industries = data.topIndustries || [
        { industry: 'Technology', count: 112 },
        { industry: 'Healthcare', count: 78 },
        { industry: 'Financial Services', count: 65 },
        { industry: 'Education', count: 42 },
        { industry: 'Legal', count: 28 }
      ];
      renderBarChart('industriesChart', industries.map(t => ({ label: t.industry, value: t.count })), 'green');
      
      // Priorities
      const priorities = data.topPriorities || [
        { category: 'Core AI Capability', avgRank: 1.8 },
        { category: 'Pricing Transparency', avgRank: 2.4 },
        { category: 'Data Privacy', avgRank: 2.9 },
        { category: 'Integration & API', avgRank: 3.2 },
        { category: 'Vendor Support', avgRank: 3.8 }
      ];
      const maxRank = 5;
      renderBarChart('prioritiesChart', priorities.map(t => ({ 
        label: t.category, 
        value: Math.round((maxRank - t.avgRank + 1) / maxRank * 100),
        display: `Avg rank: ${t.avgRank.toFixed(1)}`
      })), 'orange');
      
      // Most recommended
      const tools = data.mostRecommended || [
        { tool: 'Claude', count: 89 },
        { tool: 'GPT-4', count: 76 },
        { tool: 'Gemini', count: 54 },
        { tool: 'GitHub Copilot', count: 38 },
        { tool: 'Perplexity', count: 24 }
      ];
      renderBarChart('toolsChart', tools.map(t => ({ label: t.tool, value: t.count })), 'purple');
    }
    
    function renderBarChart(containerId, items, colorClass = '') {
      const container = document.getElementById(containerId);
      const maxValue = Math.max(...items.map(i => i.value));
      
      container.innerHTML = items.map(item => `
        <div class="bar-item">
          <div class="bar-label">${item.label}</div>
          <div class="bar-fill">
            <div class="bar-inner ${colorClass}" style="width: ${(item.value / maxValue) * 100}%">
              ${item.display || item.value}
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function renderInsights(data) {
      const insights = [
        { icon: 'üë•', text: `Small teams (2-10) are the most common profile, representing 38% of recommendations` },
        { icon: 'üéØ', text: `"Core AI Capability" is the #1 ranked priority across all industries` },
        { icon: 'üè•', text: `Healthcare users prioritize Compliance 2x more than average` },
        { icon: 'üí∞', text: `64% of users have budgets under $25/user/month` },
        { icon: '‚ö†Ô∏è', text: `5 tool categories have high demand but low review coverage ‚Äî see gaps below` }
      ];
      
      document.getElementById('insights').innerHTML = `
        <h3>üí° Key Insights</h3>
        ${insights.map(i => `
          <div class="insight-item">
            <span class="insight-icon">${i.icon}</span>
            <span>${i.text}</span>
          </div>
        `).join('')}
      `;
    }
    
    function renderGaps(data) {
      const gaps = data.gaps || [
        { name: 'AI Code Security Tools', count: 45, industry: 'Technology', reviewed: false },
        { name: 'Healthcare AI Assistants', count: 38, industry: 'Healthcare', reviewed: false },
        { name: 'Legal Document AI', count: 32, industry: 'Legal', reviewed: false },
        { name: 'Financial Analysis AI', count: 28, industry: 'Financial', reviewed: false },
        { name: 'AI Video Editors', count: 24, industry: 'Media', reviewed: false }
      ];
      
      const tbody = document.querySelector('#gapsTable tbody');
      tbody.innerHTML = gaps.map(gap => `
        <tr>
          <td><strong>${gap.name}</strong></td>
          <td>${gap.count} searches</td>
          <td>${gap.industry}</td>
          <td>
            <span class="badge ${gap.reviewed ? 'badge-ok' : 'badge-gap'}">
              ${gap.reviewed ? 'Reviewed' : 'Gap'}
            </span>
          </td>
          <td>
            <button onclick="addToQueue('${gap.name}')" style="background:#3b82f6;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">
              Add to Queue
            </button>
          </td>
        </tr>
      `).join('');
    }
    
    function addToQueue(name) {
      alert(`Added "${name}" to the review queue with high priority.`);
    }
    
    // Load on page load
    loadAnalytics();
  </script>
</body>
</html>
